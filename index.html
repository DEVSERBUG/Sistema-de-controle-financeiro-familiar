<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanças em Família | Controle Financeiro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --light-gray: #e9ecef;
            --card-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7ff 0%, #f0f2f8 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Estilos de Autenticação */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-box {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 40px;
            width: 100%;
            max-width: 420px;
            transition: var(--transition);
        }

        .auth-box:hover {
            box-shadow: var(--hover-shadow);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .auth-logo i {
            font-size: 2.5rem;
        }

        .auth-logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .auth-subtitle {
            color: var(--gray-color);
            font-size: 0.95rem;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }

        .form-input {
            padding: 14px 16px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-select {
            padding: 14px 16px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background-color: white;
            transition: var(--transition);
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: #dde1e7;
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #22c55e;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #e11d48;
            transform: translateY(-2px);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e57b12;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 10px 16px;
            font-size: 0.9rem;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: var(--gray-color);
            font-size: 0.95rem;
        }

        .auth-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* Dashboard Styles - Cabeçalho Simplificado */
        .dashboard-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-header {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            gap: 15px;
            flex-wrap: wrap;
        }

        .dashboard-header:hover {
            box-shadow: var(--hover-shadow);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 200px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .user-details {
            overflow: hidden;
        }

        .user-details h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-details p {
            color: var(--gray-color);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .date-display {
            background: var(--light-gray);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 500;
            color: var(--dark-color);
            white-space: nowrap;
            display: none; /* Ocultado no mobile */
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-weight: 600;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            white-space: nowrap;
        }

        .logout-btn:hover {
            background-color: rgba(247, 37, 133, 0.1);
        }

        /* Menu Mobile */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-color);
            cursor: pointer;
            padding: 10px;
        }

        /* Alerta de Orçamento - Versão Mobile Otimizada */
        .budget-alert {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-radius: var(--border-radius);
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid var(--danger-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0.2); }
            70% { box-shadow: 0 0 0 8px rgba(247, 37, 133, 0); }
            100% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0); }
        }

        .budget-alert i {
            color: var(--danger-color);
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .budget-alert-content {
            flex: 1;
            min-width: 0;
        }

        .budget-alert-content h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
        }

        .budget-alert-content p {
            font-size: 0.9rem;
            color: var(--gray-color);
            white-space: normal;
            word-break: break-word;
        }

        .close-alert {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            margin-left: auto;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--hover-shadow);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary-color);
        }

        .summary-cards {
            grid-column: span 12;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 10px;
        }

        .summary-card {
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
        }

        .summary-card.income::before {
            background: linear-gradient(90deg, var(--success-color), #22c55e);
        }

        .summary-card.expenses::before {
            background: linear-gradient(90deg, var(--danger-color), #e11d48);
        }

        .summary-card.balance::before {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .summary-card-content h3 {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--gray-color);
            margin-bottom: 8px;
        }

        .summary-card-content .amount {
            font-size: 1.8rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .summary-card.income .amount {
            color: var(--success-color);
        }

        .summary-card.expenses .amount {
            color: var(--danger-color);
        }

        .summary-card.balance .amount {
            color: var(--primary-color);
        }

        .summary-card-content .trend {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
            font-size: 0.85rem;
        }

        .trend.positive {
            color: var(--success-color);
        }

        .trend.negative {
            color: var(--danger-color);
        }

        .summary-card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
            margin-left: 15px;
        }

        .summary-card.income .summary-card-icon {
            background-color: rgba(74, 222, 128, 0.1);
            color: var(--success-color);
        }

        .summary-card.expenses .summary-card-icon {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger-color);
        }

        .summary-card.balance .summary-card-icon {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .transaction-form {
            grid-column: span 4;
        }

        .quick-stats {
            grid-column: span 8;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .quick-stat {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quick-stat .stat-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-label i {
            color: var(--primary-color);
        }

        .recent-transactions {
            grid-column: span 8;
        }

        .analytics {
            grid-column: span 4;
        }

        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-radius: var(--border-radius);
            margin-bottom: 12px;
            background-color: var(--light-color);
            transition: var(--transition);
            border-left: 4px solid transparent;
            flex-wrap: wrap;
            gap: 10px;
        }

        .transaction-item:hover {
            transform: translateY(-2px);
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .transaction-item.income {
            border-left-color: var(--success-color);
        }

        .transaction-item.expense {
            border-left-color: var(--danger-color);
        }

        .transaction-info {
            flex: 1;
            min-width: 0;
        }

        .transaction-info h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transaction-details {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            color: var(--gray-color);
            flex-wrap: wrap;
        }

        .transaction-category {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .transaction-type {
            font-size: 0.8rem;
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 50px;
            white-space: nowrap;
        }

        .type-income {
            background-color: rgba(74, 222, 128, 0.1);
            color: var(--success-color);
        }

        .type-expense {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger-color);
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.1rem;
            white-space: nowrap;
        }

        .transaction-item.income .transaction-amount {
            color: var(--success-color);
        }

        .transaction-item.expense .transaction-amount {
            color: var(--danger-color);
        }

        .transaction-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .action-btn:hover {
            color: var(--dark-color);
            background-color: var(--light-gray);
        }

        .chart-container {
            position: relative;
            height: 250px;
            margin-top: 10px;
        }

        .analytics-stats {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .analytics-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
        }

        .stat-info h4 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-info p {
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        .analytics-stat .stat-value {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .budget-categories {
            grid-column: span 12;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .category-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border-top: 4px solid;
            position: relative;
        }

        .category-card.over-budget {
            animation: pulse 2s infinite;
            border: 2px solid var(--danger-color);
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .category-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            flex-shrink: 0;
        }

        .category-content {
            flex: 1;
            min-width: 0;
        }

        .category-content h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .category-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .category-progress {
            margin-top: 10px;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        .overbudget-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--danger-color);
            color: white;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 10px;
            z-index: 1;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--hover-shadow);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        /* Modal de Confirmação */
        .confirm-modal-content {
            text-align: center;
            max-width: 400px;
        }

        .confirm-icon {
            font-size: 3rem;
            color: var(--danger-color);
            margin-bottom: 20px;
        }

        .confirm-text {
            margin-bottom: 25px;
            font-size: 1.1rem;
            color: var(--dark-color);
            line-height: 1.5;
        }

        .confirm-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* Notificação Mobile Otimizada */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--hover-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
            animation: slideInRight 0.3s ease;
            max-width: none;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left: 4px solid var(--danger-color);
        }

        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            background-color: rgba(74, 222, 128, 0.1);
            color: var(--success-color);
        }

        .notification.error .notification-icon {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger-color);
        }

        .notification.warning .notification-icon {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning-color);
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-content h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-content p {
            font-size: 0.9rem;
            color: var(--gray-color);
            word-break: break-word;
        }

        .close-notification {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            margin-left: auto;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray-color);
            font-size: 0.9rem;
            padding: 20px;
        }

        /* Login Pré-configurado */
        .pre-configured-logins {
            margin-top: 25px;
            padding: 20px;
            background: var(--light-color);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }

        .pre-configured-logins h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pre-configured-logins h3 i {
            color: var(--primary-color);
        }

        .login-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .login-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--light-gray);
        }

        .login-info {
            display: flex;
            flex-direction: column;
        }

        .login-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .login-credentials {
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        .login-quick-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .login-quick-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        /* RESPONSIVIDADE OTIMIZADA */
        /* Desktop: Mostra data no cabeçalho */
        @media (min-width: 769px) {
            .date-display {
                display: block;
            }
        }

        /* Tablet e Mobile */
        @media (max-width: 1200px) {
            .transaction-form, .recent-transactions, .analytics {
                grid-column: span 12;
            }
            
            .quick-stats {
                grid-column: span 12;
            }
        }

        @media (max-width: 768px) {
            .dashboard-header {
                padding: 15px 20px;
            }
            
            .user-info {
                min-width: 0;
            }
            
            .user-details h2 {
                font-size: 1.1rem;
            }
            
            .user-details p {
                font-size: 0.85rem;
            }
            
            .header-actions {
                gap: 10px;
            }
            
            .logout-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .summary-card {
                padding: 20px;
            }
            
            .summary-card-content .amount {
                font-size: 1.6rem;
            }
            
            .summary-card-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .card {
                padding: 20px;
            }
            
            .card-title {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }
            
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .quick-stat .stat-value {
                font-size: 1.4rem;
            }
            
            .stat-label {
                font-size: 0.85rem;
            }
            
            .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .category-card {
                padding: 15px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .transaction-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .transaction-item {
                padding: 15px;
            }
            
            .transaction-amount {
                font-size: 1rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
            
            .pre-configured-logins {
                padding: 15px;
            }
            
            .login-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .login-quick-btn {
                align-self: flex-end;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .auth-box {
                padding: 25px 20px;
            }
            
            .auth-logo h1 {
                font-size: 1.5rem;
            }
            
            .auth-logo i {
                font-size: 2rem;
            }
            
            .dashboard-container {
                padding: 15px;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .user-info {
                justify-content: center;
                text-align: center;
                flex-direction: column;
                gap: 10px;
            }
            
            .user-avatar {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .header-actions {
                justify-content: center;
                width: 100%;
            }
            
            .summary-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .summary-card-icon {
                align-self: flex-end;
                margin-left: 0;
            }
            
            .summary-card-content .amount {
                font-size: 1.8rem;
            }
            
            .quick-stats {
                grid-template-columns: 1fr;
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .transaction-amount {
                align-self: flex-end;
                margin-left: 0;
            }
            
            .transaction-actions {
                align-self: flex-end;
            }
            
            .chart-container {
                height: 200px;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                padding: 15px;
            }
        }

        /* Dispositivos muito pequenos */
        @media (max-width: 360px) {
            .auth-box {
                padding: 20px 15px;
            }
            
            .auth-logo {
                flex-direction: column;
                gap: 10px;
            }
            
            .auth-logo h1 {
                font-size: 1.3rem;
                text-align: center;
            }
            
            .dashboard-container {
                padding: 10px;
            }
            
            .summary-card-content .amount {
                font-size: 1.5rem;
            }
            
            .card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="auth-container" id="auth-container">
        <div class="auth-box animate__animated animate__fadeIn">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-piggy-bank"></i>
                    <h1>Finanças em Família</h1>
                </div>
                <p class="auth-subtitle">Controle financeiro compartilhado para você e sua família</p>
            </div>
            
            <form class="auth-form" id="login-form">
                <div class="form-group">
                    <label class="form-label" for="login-email">E-mail ou Nome de Usuário</label>
                    <input type="text" class="form-input" id="login-email" placeholder="seu@email.com ou nome" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="login-password">Senha</label>
                    <input type="password" class="form-input" id="login-password" placeholder="Sua senha" required>
                </div>
                
                <button type="submit" class="btn btn-primary" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
                
                <div class="auth-switch">
                    Não tem uma conta? <a class="auth-link" id="show-register">Cadastre-se</a>
                </div>
            </form>
            
            <form class="auth-form" id="register-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label" for="register-name">Nome</label>
                    <input type="text" class="form-input" id="register-name" placeholder="Seu nome completo" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="register-email">E-mail</label>
                    <input type="email" class="form-input" id="register-email" placeholder="seu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="register-password">Senha</label>
                    <input type="password" class="form-input" id="register-password" placeholder="Mínimo 6 caracteres" minlength="6" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="register-confirm">Confirme a Senha</label>
                    <input type="password" class="form-input" id="register-confirm" placeholder="Digite novamente" required>
                </div>
                
                <button type="submit" class="btn btn-success" id="register-btn">
                    <i class="fas fa-user-plus"></i> Criar Conta
                </button>
                
                <div class="auth-switch">
                    Já tem uma conta? <a class="auth-link" id="show-login">Faça login</a>
                </div>
            </form>
            
            <!-- Logins Pré-configurados -->
            <div class="pre-configured-logins">
                <h3><i class="fas fa-users"></i> Logins da Família</h3>
                <div class="login-list">
                    <div class="login-item">
                        <div class="login-info">
                            <span class="login-name">LUANA</span>
                            <span class="login-credentials">Senha: mariajulia</span>
                        </div>
                        <button class="login-quick-btn" onclick="app.quickLogin('LUANA', 'mariajulia')">
                            <i class="fas fa-bolt"></i> Acessar
                        </button>
                    </div>
                    <div class="login-item">
                        <div class="login-info">
                            <span class="login-name">RICARDO</span>
                            <span class="login-credentials">Senha: mariajulia</span>
                        </div>
                        <button class="login-quick-btn" onclick="app.quickLogin('RICARDO', 'mariajulia')">
                            <i class="fas fa-bolt"></i> Acessar
                        </button>
                    </div>
                </div>
                <p style="margin-top: 10px; font-size: 0.85rem; color: var(--gray-color); text-align: center;">
                    <i class="fas fa-info-circle"></i> Cada usuário tem seu próprio dashboard e dados
                </p>
            </div>
        </div>
    </div>

    <!-- Dashboard Principal -->
    <div class="dashboard-container" id="dashboard-container">
        <header class="dashboard-header">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-details">
                    <h2 id="user-name">Usuário</h2>
                    <p id="user-email">usuario@email.com</p>
                </div>
            </div>
            
            <div class="header-actions">
                <div class="date-display" id="current-date"></div>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </header>
        
        <!-- Alerta de Orçamento Ultrapassado -->
        <div class="budget-alert" id="budget-alert" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="budget-alert-content">
                <h4>Orçamento Ultrapassado!</h4>
                <p id="budget-alert-message">Uma ou mais categorias ultrapassaram o orçamento definido.</p>
            </div>
            <button class="close-alert" id="close-budget-alert">&times;</button>
        </div>
        
        <div class="dashboard-grid">
            <!-- Cards de Resumo -->
            <div class="summary-cards">
                <div class="summary-card income">
                    <div class="summary-card-content">
                        <h3>Receita Total</h3>
                        <div class="amount">R$ <span id="total-income">0.00</span></div>
                        <div class="trend positive">
                            <i class="fas fa-arrow-up"></i> <span>12% este mês</span>
                        </div>
                    </div>
                    <div class="summary-card-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                </div>
                
                <div class="summary-card expenses">
                    <div class="summary-card-content">
                        <h3>Despesas Totais</h3>
                        <div class="amount">R$ <span id="total-expenses">0.00</span></div>
                        <div class="trend negative">
                            <i class="fas fa-arrow-down"></i> <span>8% este mês</span>
                        </div>
                    </div>
                    <div class="summary-card-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                </div>
                
                <div class="summary-card balance">
                    <div class="summary-card-content">
                        <h3>Saldo Disponível</h3>
                        <div class="amount">R$ <span id="current-balance">0.00</span></div>
                        <div class="trend positive">
                            <i class="fas fa-piggy-bank"></i> <span>Balanço positivo</span>
                        </div>
                    </div>
                    <div class="summary-card-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                </div>
            </div>
            
            <!-- Formulário de Transação -->
            <div class="card transaction-form">
                <h2 class="card-title"><i class="fas fa-plus-circle"></i> Nova Transação</h2>
                <form id="transaction-form">
                    <div class="form-group">
                        <label class="form-label" for="transaction-description">Descrição</label>
                        <input type="text" class="form-input" id="transaction-description" placeholder="Ex: Salário, Supermercado" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="transaction-amount">Valor (R$)</label>
                        <input type="number" class="form-input" id="transaction-amount" step="0.01" min="0" placeholder="0,00" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="transaction-type">Tipo</label>
                            <select class="form-select" id="transaction-type" required>
                                <option value="">Selecione</option>
                                <option value="income">Receita</option>
                                <option value="expense">Despesa</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="transaction-category">Categoria</label>
                            <select class="form-select" id="transaction-category" required>
                                <option value="">Selecione</option>
                                <!-- Categorias serão carregadas via JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="transaction-date">Data</label>
                        <input type="date" class="form-input" id="transaction-date" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Transação
                        </button>
                        <button type="button" class="btn btn-secondary" id="clear-form">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Estatísticas Rápidas -->
            <div class="card quick-stats">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> Estatísticas do Mês</h2>
                <div class="quick-stat">
                    <div class="stat-value" id="month-income">R$ 0.00</div>
                    <div class="stat-label">
                        <i class="fas fa-arrow-up"></i> Receita deste mês
                    </div>
                </div>
                <div class="quick-stat">
                    <div class="stat-value" id="month-expenses">R$ 0.00</div>
                    <div class="stat-label">
                        <i class="fas fa-arrow-down"></i> Despesas deste mês
                    </div>
                </div>
                <div class="quick-stat">
                    <div class="stat-value" id="avg-daily">R$ 0.00</div>
                    <div class="stat-label">
                        <i class="fas fa-calendar-day"></i> Média diária
                    </div>
                </div>
                <div class="quick-stat">
                    <div class="stat-value" id="transactions-count">0</div>
                    <div class="stat-label">
                        <i class="fas fa-exchange-alt"></i> Transações
                    </div>
                </div>
            </div>
            
            <!-- Transações Recentes -->
            <div class="card recent-transactions">
                <div class="card-title">
                    <i class="fas fa-history"></i> Transações Recentes
                    <button class="btn btn-sm btn-secondary" id="filter-transactions" style="margin-left: auto;">
                        <i class="fas fa-filter"></i> Filtrar
                    </button>
                </div>
                <div class="transactions-list" id="transactions-list">
                    <!-- Transações serão carregadas via JavaScript -->
                </div>
            </div>
            
            <!-- Análises -->
            <div class="card analytics">
                <h2 class="card-title"><i class="fas fa-chart-pie"></i> Análise de Gastos</h2>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="analytics-stats">
                    <div class="analytics-stat">
                        <div class="stat-info">
                            <h4>Maior Despesa</h4>
                            <p id="top-expense-category">-</p>
                        </div>
                        <div class="stat-value" id="top-expense-value">R$ 0.00</div>
                    </div>
                    <div class="analytics-stat">
                        <div class="stat-info">
                            <h4>Economia do Mês</h4>
                            <p>Meta: 20% da receita</p>
                        </div>
                        <div class="stat-value" id="savings-rate">0%</div>
                    </div>
                </div>
            </div>
            
            <!-- Categorias de Orçamento -->
            <div class="card budget-categories">
                <div class="card-title">
                    <i class="fas fa-tags"></i> Categorias de Orçamento
                    <button class="btn btn-sm btn-primary" id="add-category" style="margin-left: auto;">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
                <div class="categories-grid" id="categories-grid">
                    <!-- Categorias serão carregadas via JavaScript -->
                </div>
            </div>
        </div>
        
        <footer>
            <p>Finanças em Família &copy; 2023 | Sistema de controle financeiro compartilhado</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">Dados armazenados localmente no seu navegador</p>
        </footer>
    </div>

    <!-- Modal de Categorias -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nova Categoria</h3>
                <button class="close-modal" id="close-category-modal">&times;</button>
            </div>
            <form id="category-form">
                <div class="form-group">
                    <label class="form-label" for="category-name">Nome da Categoria</label>
                    <input type="text" class="form-input" id="category-name" placeholder="Ex: Lazer, Educação" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="category-budget">Orçamento Mensal (R$)</label>
                    <input type="number" class="form-input" id="category-budget" step="0.01" min="0" placeholder="0,00" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="category-color">Cor da Categoria</label>
                    <input type="color" class="form-input" id="category-color" value="#4361ee" style="height: 50px; padding: 5px;">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="category-icon">Ícone</label>
                    <select class="form-select" id="category-icon" required>
                        <option value="fa-home">Casa</option>
                        <option value="fa-utensils">Alimentação</option>
                        <option value="fa-car">Transporte</option>
                        <option value="fa-heart">Saúde</option>
                        <option value="fa-graduation-cap">Educação</option>
                        <option value="fa-film">Lazer</option>
                        <option value="fa-shopping-cart">Compras</option>
                        <option value="fa-ellipsis-h">Outros</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvar Categoria</button>
                    <button type="button" class="btn btn-secondary" id="cancel-category-modal">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content confirm-modal-content">
            <div class="confirm-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="confirm-text" id="confirm-text">
                Tem certeza que deseja excluir esta categoria?
            </div>
            <div class="confirm-actions">
                <button class="btn btn-danger" id="confirm-delete">Excluir</button>
                <button class="btn btn-secondary" id="cancel-delete">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Notificação -->
    <div class="notification" id="notification" style="display: none;">
        <div class="notification-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="notification-content">
            <h4 id="notification-title">Sucesso!</h4>
            <p id="notification-message">Operação realizada com sucesso.</p>
        </div>
        <button class="close-notification" id="close-notification">&times;</button>
    </div>

    <script>
        // Sistema Financeiro Familiar Avançado
        class FinanceApp {
            constructor() {
                this.currentUser = null;
                this.users = JSON.parse(localStorage.getItem('finance_users')) || [];
                this.transactions = JSON.parse(localStorage.getItem('finance_transactions')) || [];
                this.categories = JSON.parse(localStorage.getItem('finance_categories')) || this.getDefaultCategories();
                this.budgets = JSON.parse(localStorage.getItem('finance_budgets')) || [];
                
                // Para controle de exclusão de categoria
                this.categoryToDelete = null;
                
                this.init();
            }
            
            getDefaultCategories() {
                return [
                    { id: 1, name: 'Salário', type: 'income', color: '#4ade80', icon: 'fa-money-bill-wave' },
                    { id: 2, name: 'Freelance', type: 'income', color: '#22c55e', icon: 'fa-laptop-code' },
                    { id: 3, name: 'Investimentos', type: 'income', color: '#10b981', icon: 'fa-chart-line' },
                    { id: 4, name: 'Moradia', type: 'expense', color: '#3b82f6', icon: 'fa-home' },
                    { id: 5, name: 'Alimentação', type: 'expense', color: '#ef4444', icon: 'fa-utensils' },
                    { id: 6, name: 'Transporte', type: 'expense', color: '#f59e0b', icon: 'fa-car' },
                    { id: 7, name: 'Saúde', type: 'expense', color: '#8b5cf6', icon: 'fa-heart' },
                    { id: 8, name: 'Lazer', type: 'expense', color: '#ec4899', icon: 'fa-film' },
                    { id: 9, name: 'Educação', type: 'expense', color: '#6366f1', icon: 'fa-graduation-cap' },
                    { id: 10, name: 'Outros', type: 'expense', color: '#6b7280', icon: 'fa-ellipsis-h' }
                ];
            }
            
            init() {
                // Adiciona os usuários padrão se não existirem
                this.addDefaultUsers();
                
                this.setupEventListeners();
                this.updateDate();
                this.checkAuth();
                this.loadCategoriesToSelect();
            }
            
            addDefaultUsers() {
                // Verifica se os usuários padrão já existem
                const existingLuana = this.users.find(u => u.name === 'LUANA' || u.email === 'LUANA');
                const existingRicardo = this.users.find(u => u.name === 'RICARDO' || u.email === 'RICARDO');
                
                // Adiciona LUANA se não existir
                if (!existingLuana) {
                    const luanaUser = {
                        id: 1,
                        name: 'LUANA',
                        email: 'luana@familia.com',
                        password: 'mariajulia',
                        avatar: 'L',
                        joined: new Date().toISOString()
                    };
                    this.users.push(luanaUser);
                }
                
                // Adiciona RICARDO se não existir
                if (!existingRicardo) {
                    const ricardoUser = {
                        id: 2,
                        name: 'RICARDO',
                        email: 'ricardo@familia.com',
                        password: 'mariajulia',
                        avatar: 'R',
                        joined: new Date().toISOString()
                    };
                    this.users.push(ricardoUser);
                }
                
                // Salva os usuários no localStorage
                this.saveUsers();
            }
            
            setupEventListeners() {
                // Autenticação
                document.getElementById('show-register').addEventListener('click', () => this.toggleAuthForms());
                document.getElementById('show-login').addEventListener('click', () => this.toggleAuthForms());
                document.getElementById('login-form').addEventListener('submit', (e) => this.handleLogin(e));
                document.getElementById('register-form').addEventListener('submit', (e) => this.handleRegister(e));
                document.getElementById('logout-btn').addEventListener('click', () => this.handleLogout());
                
                // Transações
                document.getElementById('transaction-form').addEventListener('submit', (e) => this.handleAddTransaction(e));
                document.getElementById('clear-form').addEventListener('click', () => this.clearTransactionForm());
                document.getElementById('transaction-type').addEventListener('change', () => this.filterCategoriesByType());
                
                // Categorias
                document.getElementById('add-category').addEventListener('click', () => this.openCategoryModal());
                document.getElementById('close-category-modal').addEventListener('click', () => this.closeCategoryModal());
                document.getElementById('cancel-category-modal').addEventListener('click', () => this.closeCategoryModal());
                document.getElementById('category-form').addEventListener('submit', (e) => this.handleAddCategory(e));
                
                // Confirmação de exclusão
                document.getElementById('confirm-delete').addEventListener('click', () => this.deleteCategoryConfirmed());
                document.getElementById('cancel-delete').addEventListener('click', () => this.closeConfirmModal());
                
                // Alerta de orçamento
                document.getElementById('close-budget-alert').addEventListener('click', () => this.hideBudgetAlert());
                
                // Filtros
                document.getElementById('filter-transactions').addEventListener('click', () => this.filterTransactions());
                
                // Notificação
                document.getElementById('close-notification').addEventListener('click', () => this.hideNotification());
                
                // Inicializar data no formulário
                document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
            }
            
            updateDate() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('current-date').textContent = now.toLocaleDateString('pt-BR', options);
            }
            
            checkAuth() {
                const savedUser = localStorage.getItem('finance_current_user');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.showDashboard();
                }
            }
            
            toggleAuthForms() {
                const loginForm = document.getElementById('login-form');
                const registerForm = document.getElementById('register-form');
                
                if (loginForm.style.display === 'none') {
                    loginForm.style.display = 'flex';
                    registerForm.style.display = 'none';
                } else {
                    loginForm.style.display = 'none';
                    registerForm.style.display = 'flex';
                }
            }
            
            quickLogin(username, password) {
                // Preenche automaticamente os campos
                document.getElementById('login-email').value = username;
                document.getElementById('login-password').value = password;
                
                // Simula clique no botão de login
                document.getElementById('login-btn').click();
            }
            
            handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                // Procura usuário por nome ou email
                const user = this.users.find(u => 
                    (u.name === username || u.email === username) && 
                    u.password === password
                );
                
                if (user) {
                    this.currentUser = user;
                    localStorage.setItem('finance_current_user', JSON.stringify(user));
                    this.showNotification(`Bem-vindo(a), ${user.name}!`, 'success');
                    this.showDashboard();
                } else {
                    this.showNotification('Usuário ou senha incorretos.', 'error');
                }
            }
            
            handleRegister(e) {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;
                
                if (password !== confirm) {
                    this.showNotification('As senhas não coincidem.', 'error');
                    return;
                }
                
                if (this.users.find(u => u.email === email)) {
                    this.showNotification('Este e-mail já está cadastrado.', 'error');
                    return;
                }
                
                if (this.users.find(u => u.name === name)) {
                    this.showNotification('Este nome de usuário já está em uso.', 'error');
                    return;
                }
                
                const newUser = {
                    id: Date.now(),
                    name,
                    email,
                    password,
                    avatar: name.charAt(0).toUpperCase(),
                    joined: new Date().toISOString()
                };
                
                this.users.push(newUser);
                this.saveUsers();
                
                this.showNotification('Conta criada com sucesso! Faça login.', 'success');
                this.toggleAuthForms();
                
                // Limpar formulário
                document.getElementById('register-form').reset();
            }
            
            handleLogout() {
                this.currentUser = null;
                localStorage.removeItem('finance_current_user');
                this.showNotification('Logout realizado com sucesso.', 'success');
                this.showAuth();
            }
            
            showAuth() {
                document.getElementById('auth-container').style.display = 'flex';
                document.getElementById('dashboard-container').style.display = 'none';
            }
            
            showDashboard() {
                document.getElementById('auth-container').style.display = 'none';
                document.getElementById('dashboard-container').style.display = 'block';
                
                // Atualizar informações do usuário
                document.getElementById('user-name').textContent = this.currentUser.name;
                document.getElementById('user-email').textContent = this.currentUser.email || `${this.currentUser.name.toLowerCase()}@familia.com`;
                document.getElementById('user-avatar').textContent = this.currentUser.avatar;
                
                // Atualizar dados do dashboard
                this.updateDashboard();
            }
            
            updateDashboard() {
                this.updateSummaryCards();
                this.updateRecentTransactions();
                this.updateCategoryChart();
                this.updateBudgetCategories();
                this.updateQuickStats();
                this.checkBudgetAlerts();
            }
            
            updateSummaryCards() {
                const userTransactions = this.transactions.filter(t => t.userId === this.currentUser.id);
                
                const totalIncome = userTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const totalExpenses = userTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const balance = totalIncome - totalExpenses;
                
                document.getElementById('total-income').textContent = totalIncome.toFixed(2);
                document.getElementById('total-expenses').textContent = totalExpenses.toFixed(2);
                document.getElementById('current-balance').textContent = balance.toFixed(2);
            }
            
            loadCategoriesToSelect() {
                const select = document.getElementById('transaction-category');
                select.innerHTML = '<option value="">Selecione</option>';
                
                // Carregar categorias de receita primeiro
                this.categories.filter(c => c.type === 'income').forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    option.dataset.type = category.type;
                    select.appendChild(option);
                });
                
                // Carregar categorias de despesa
                this.categories.filter(c => c.type === 'expense').forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    option.dataset.type = category.type;
                    select.appendChild(option);
                });
            }
            
            filterCategoriesByType() {
                const type = document.getElementById('transaction-type').value;
                const select = document.getElementById('transaction-category');
                const options = select.querySelectorAll('option');
                
                options.forEach(option => {
                    if (option.value === '') return;
                    
                    if (type === '' || option.dataset.type === type) {
                        option.style.display = 'block';
                    } else {
                        option.style.display = 'none';
                    }
                });
                
                // Resetar seleção se não for compatível
                if (type && select.options[select.selectedIndex].dataset.type !== type) {
                    select.value = '';
                }
            }
            
            handleAddTransaction(e) {
                e.preventDefault();
                
                const description = document.getElementById('transaction-description').value;
                const amount = parseFloat(document.getElementById('transaction-amount').value);
                const type = document.getElementById('transaction-type').value;
                const categoryId = parseInt(document.getElementById('transaction-category').value);
                const date = document.getElementById('transaction-date').value;
                
                if (!description || !amount || !type || !categoryId || !date) {
                    this.showNotification('Preencha todos os campos.', 'error');
                    return;
                }
                
                const category = this.categories.find(c => c.id === categoryId);
                
                if (!category) {
                    this.showNotification('Categoria não encontrada.', 'error');
                    return;
                }
                
                // Verificar se é uma despesa e se ultrapassa o orçamento
                if (type === 'expense') {
                    const budget = this.budgets.find(b => b.userId === this.currentUser.id && b.categoryId === categoryId);
                    if (budget) {
                        const currentMonthExpenses = this.getCurrentMonthCategoryExpenses(categoryId);
                        const newTotal = currentMonthExpenses + amount;
                        
                        if (newTotal > budget.amount) {
                            const overBudgetPercent = ((newTotal / budget.amount) * 100 - 100).toFixed(0);
                            const confirmAdd = confirm(`Atenção! Adicionar esta despesa fará com que a categoria "${category.name}" ultrapasse o orçamento em ${overBudgetPercent}%.\n\nDeseja continuar mesmo assim?`);
                            
                            if (!confirmAdd) {
                                return;
                            }
                        }
                    }
                }
                
                const newTransaction = {
                    id: Date.now(),
                    userId: this.currentUser.id,
                    description,
                    amount,
                    type,
                    category: category.name,
                    categoryId,
                    date,
                    createdAt: new Date().toISOString()
                };
                
                this.transactions.push(newTransaction);
                this.saveTransactions();
                
                this.showNotification(`${type === 'income' ? 'Receita' : 'Despesa'} registrada com sucesso!`, 'success');
                this.clearTransactionForm();
                this.updateDashboard();
                
                // Verificar se ultrapassou o orçamento após adicionar
                if (type === 'expense') {
                    this.checkBudgetAlerts();
                }
            }
            
            getCurrentMonthCategoryExpenses(categoryId) {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                return this.transactions
                    .filter(t => t.userId === this.currentUser.id && 
                           t.type === 'expense' && 
                           t.categoryId === categoryId)
                    .filter(t => {
                        const transDate = new Date(t.date);
                        return transDate.getMonth() === currentMonth && transDate.getFullYear() === currentYear;
                    })
                    .reduce((sum, t) => sum + t.amount, 0);
            }
            
            clearTransactionForm() {
                document.getElementById('transaction-form').reset();
                document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
            }
            
            updateRecentTransactions() {
                const container = document.getElementById('transactions-list');
                const userTransactions = this.transactions
                    .filter(t => t.userId === this.currentUser.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 10);
                
                if (userTransactions.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6c757d;">
                            <i class="fas fa-receipt" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3>Nenhuma transação registrada</h3>
                            <p>Comece adicionando sua primeira receita ou despesa.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                userTransactions.forEach(transaction => {
                    const category = this.categories.find(c => c.id === transaction.categoryId);
                    const categoryColor = category ? category.color : '#6c7280';
                    
                    html += `
                        <div class="transaction-item ${transaction.type}">
                            <div class="transaction-info">
                                <h4>${transaction.description}</h4>
                                <div class="transaction-details">
                                    <span class="transaction-category" style="background-color: ${categoryColor}20; color: ${categoryColor};">
                                        <i class="fas ${category ? category.icon : 'fa-tag'}"></i> ${transaction.category}
                                    </span>
                                    <span class="transaction-type ${transaction.type === 'income' ? 'type-income' : 'type-expense'}">
                                        ${transaction.type === 'income' ? 'Receita' : 'Despesa'}
                                    </span>
                                    <span style="color: #6c757d;">${this.formatDate(transaction.date)}</span>
                                </div>
                            </div>
                            <div class="transaction-amount">
                                ${transaction.type === 'income' ? '+' : '-'} R$ ${transaction.amount.toFixed(2)}
                            </div>
                            <div class="transaction-actions">
                                <button class="action-btn" onclick="app.deleteTransaction(${transaction.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            updateCategoryChart() {
                const ctx = document.getElementById('categoryChart').getContext('2d');
                const userTransactions = this.transactions.filter(t => t.userId === this.currentUser.id && t.type === 'expense');
                
                // Agrupar despesas por categoria
                const categoryMap = {};
                userTransactions.forEach(transaction => {
                    if (!categoryMap[transaction.categoryId]) {
                        categoryMap[transaction.categoryId] = {
                            name: transaction.category,
                            amount: 0,
                            color: '#6c7280'
                        };
                    }
                    categoryMap[transaction.categoryId].amount += transaction.amount;
                });
                
                // Encontrar categoria com maior gasto
                let topCategory = { name: '-', amount: 0 };
                Object.values(categoryMap).forEach(cat => {
                    if (cat.amount > topCategory.amount) {
                        topCategory = cat;
                    }
                });
                
                document.getElementById('top-expense-category').textContent = topCategory.name;
                document.getElementById('top-expense-value').textContent = `R$ ${topCategory.amount.toFixed(2)}`;
                
                // Calcular taxa de economia
                const totalIncome = this.transactions
                    .filter(t => t.userId === this.currentUser.id && t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const totalExpenses = Object.values(categoryMap).reduce((sum, cat) => sum + cat.amount, 0);
                const savings = totalIncome - totalExpenses;
                const savingsRate = totalIncome > 0 ? Math.round((savings / totalIncome) * 100) : 0;
                
                document.getElementById('savings-rate').textContent = `${savingsRate}%`;
                
                // Atualizar cores das categorias
                Object.keys(categoryMap).forEach(catId => {
                    const category = this.categories.find(c => c.id === parseInt(catId));
                    if (category) {
                        categoryMap[catId].color = category.color;
                    }
                });
                
                // Destruir gráfico existente
                if (window.categoryChartInstance) {
                    window.categoryChartInstance.destroy();
                }
                
                // Criar novo gráfico
                if (Object.keys(categoryMap).length > 0) {
                    window.categoryChartInstance = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.values(categoryMap).map(cat => cat.name),
                            datasets: [{
                                data: Object.values(categoryMap).map(cat => cat.amount),
                                backgroundColor: Object.values(categoryMap).map(cat => cat.color),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 15,
                                        font: {
                                            size: window.innerWidth < 768 ? 10 : 12
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const value = context.raw;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = Math.round((value / total) * 100);
                                            return `R$ ${value.toFixed(2)} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                } else {
                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                    ctx.font = '16px sans-serif';
                    ctx.fillStyle = '#6c757d';
                    ctx.textAlign = 'center';
                    ctx.fillText('Nenhuma despesa registrada', ctx.canvas.width / 2, ctx.canvas.height / 2);
                }
            }
            
            updateBudgetCategories() {
                const container = document.getElementById('categories-grid');
                const userTransactions = this.transactions.filter(t => t.userId === this.currentUser.id);
                
                let html = '';
                const expenseCategories = this.categories.filter(c => c.type === 'expense' && (!c.userId || c.userId === this.currentUser.id));
                
                if (expenseCategories.length === 0) {
                    html = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #6c757d;">
                            <i class="fas fa-tags" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3>Nenhuma categoria de despesa configurada</h3>
                            <p>Adicione categorias para acompanhar seus orçamentos.</p>
                        </div>
                    `;
                } else {
                    expenseCategories.forEach(category => {
                        const categoryExpenses = userTransactions
                            .filter(t => t.categoryId === category.id)
                            .reduce((sum, t) => sum + t.amount, 0);
                        
                        // Orçamento
                        const budget = this.budgets.find(b => b.userId === this.currentUser.id && b.categoryId === category.id) || 
                                      { amount: 1000 }; // Valor padrão
                        
                        const percentage = budget.amount > 0 ? Math.min(100, (categoryExpenses / budget.amount) * 100) : 0;
                        const progressColor = percentage > 90 ? '#ef4444' : percentage > 70 ? '#f59e0b' : '#4ade80';
                        
                        // Verificar se ultrapassou o orçamento
                        const isOverBudget = categoryExpenses > budget.amount;
                        
                        html += `
                            <div class="category-card ${isOverBudget ? 'over-budget' : ''}" style="border-top-color: ${category.color};">
                                ${isOverBudget ? '<div class="overbudget-badge"><i class="fas fa-exclamation-triangle"></i> Ultrapassado</div>' : ''}
                                <div class="category-header">
                                    <div class="category-icon" style="background-color: ${category.color};">
                                        <i class="fas ${category.icon}"></i>
                                    </div>
                                    <div style="font-weight: 600; color: ${category.color};">R$ ${categoryExpenses.toFixed(2)}</div>
                                </div>
                                <div class="category-content">
                                    <h4>
                                        ${category.name}
                                        <div class="category-actions">
                                            <button class="action-btn" onclick="app.confirmDeleteCategory(${category.id})" title="Excluir categoria">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </h4>
                                    <div class="category-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${percentage}%; background-color: ${progressColor};"></div>
                                        </div>
                                        <div class="progress-info">
                                            <span>R$ ${categoryExpenses.toFixed(2)} de R$ ${budget.amount.toFixed(2)}</span>
                                            <span>${percentage.toFixed(1)}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
                
                container.innerHTML = html;
            }
            
            updateQuickStats() {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                const userTransactions = this.transactions.filter(t => t.userId === this.currentUser.id);
                
                // Transações do mês atual
                const monthTransactions = userTransactions.filter(t => {
                    const transDate = new Date(t.date);
                    return transDate.getMonth() === currentMonth && transDate.getFullYear() === currentYear;
                });
                
                const monthIncome = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthExpenses = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                const avgDaily = monthExpenses / daysInMonth;
                
                document.getElementById('month-income').textContent = `R$ ${monthIncome.toFixed(2)}`;
                document.getElementById('month-expenses').textContent = `R$ ${monthExpenses.toFixed(2)}`;
                document.getElementById('avg-daily').textContent = `R$ ${avgDaily.toFixed(2)}`;
                document.getElementById('transactions-count').textContent = userTransactions.length;
            }
            
            checkBudgetAlerts() {
                const userTransactions = this.transactions.filter(t => t.userId === this.currentUser.id);
                const expenseCategories = this.categories.filter(c => c.type === 'expense' && (!c.userId || c.userId === this.currentUser.id));
                
                let overBudgetCategories = [];
                
                expenseCategories.forEach(category => {
                    const categoryExpenses = userTransactions
                        .filter(t => t.categoryId === category.id)
                        .reduce((sum, t) => sum + t.amount, 0);
                    
                    const budget = this.budgets.find(b => b.userId === this.currentUser.id && b.categoryId === category.id);
                    
                    if (budget && categoryExpenses > budget.amount) {
                        const overBudgetPercent = ((categoryExpenses / budget.amount) * 100 - 100).toFixed(0);
                        overBudgetCategories.push({
                            name: category.name,
                            percent: overBudgetPercent
                        });
                    }
                });
                
                if (overBudgetCategories.length > 0) {
                    let message = '';
                    if (overBudgetCategories.length === 1) {
                        message = `A categoria "${overBudgetCategories[0].name}" ultrapassou o orçamento em ${overBudgetCategories[0].percent}%.`;
                    } else {
                        message = `${overBudgetCategories.length} categorias ultrapassaram o orçamento.`;
                        // Para mobile, mensagem mais curta
                        if (window.innerWidth < 768) {
                            message = `${overBudgetCategories.length} categorias ultrapassaram o orçamento.`;
                        } else {
                            message += ` ${overBudgetCategories.map(c => `${c.name} (${c.percent}%)`).join(', ')}`;
                        }
                    }
                    
                    document.getElementById('budget-alert-message').textContent = message;
                    document.getElementById('budget-alert').style.display = 'flex';
                    
                    // Mostrar notificação apenas uma vez por sessão
                    if (!sessionStorage.getItem('budget_alert_shown')) {
                        this.showNotification(message, 'warning');
                        sessionStorage.setItem('budget_alert_shown', 'true');
                    }
                } else {
                    this.hideBudgetAlert();
                }
            }
            
            hideBudgetAlert() {
                document.getElementById('budget-alert').style.display = 'none';
            }
            
            openCategoryModal() {
                document.getElementById('category-modal').style.display = 'flex';
            }
            
            closeCategoryModal() {
                document.getElementById('category-modal').style.display = 'none';
                document.getElementById('category-form').reset();
            }
            
            handleAddCategory(e) {
                e.preventDefault();
                
                const name = document.getElementById('category-name').value;
                const budget = parseFloat(document.getElementById('category-budget').value);
                const color = document.getElementById('category-color').value;
                const icon = document.getElementById('category-icon').value;
                
                const newCategory = {
                    id: Date.now(),
                    name,
                    type: 'expense',
                    color,
                    icon,
                    userId: this.currentUser.id
                };
                
                this.categories.push(newCategory);
                this.saveCategories();
                
                // Adicionar orçamento
                const newBudget = {
                    id: Date.now(),
                    userId: this.currentUser.id,
                    categoryId: newCategory.id,
                    amount: budget
                };
                
                this.budgets.push(newBudget);
                this.saveBudgets();
                
                this.showNotification('Categoria adicionada com sucesso!', 'success');
                this.closeCategoryModal();
                this.updateDashboard();
                this.loadCategoriesToSelect();
            }
            
            confirmDeleteCategory(categoryId) {
                const category = this.categories.find(c => c.id === categoryId);
                if (!category) return;
                
                // Verificar se há transações nesta categoria
                const hasTransactions = this.transactions.some(t => t.userId === this.currentUser.id && t.categoryId === categoryId);
                
                let message = `Tem certeza que deseja excluir a categoria "${category.name}"?`;
                if (hasTransactions) {
                    message += "\n\nAtenção: Existem transações associadas a esta categoria. Elas serão movidas para a categoria 'Outros'. Esta ação não pode ser desfeita.";
                }
                
                this.categoryToDelete = categoryId;
                document.getElementById('confirm-text').textContent = message;
                document.getElementById('confirm-modal').style.display = 'flex';
            }
            
            deleteCategoryConfirmed() {
                if (!this.categoryToDelete) return;
                
                const categoryId = this.categoryToDelete;
                const otherCategory = this.categories.find(c => c.name === 'Outros' && c.type === 'expense');
                
                // Mover transações para categoria "Outros" se existir
                if (otherCategory) {
                    this.transactions.forEach(transaction => {
                        if (transaction.userId === this.currentUser.id && transaction.categoryId === categoryId) {
                            transaction.categoryId = otherCategory.id;
                            transaction.category = otherCategory.name;
                        }
                    });
                    this.saveTransactions();
                }
                
                // Remover orçamento associado
                this.budgets = this.budgets.filter(b => !(b.userId === this.currentUser.id && b.categoryId === categoryId));
                this.saveBudgets();
                
                // Remover categoria
                this.categories = this.categories.filter(c => c.id !== categoryId);
                this.saveCategories();
                
                this.showNotification('Categoria excluída com sucesso!', 'success');
                this.closeConfirmModal();
                this.updateDashboard();
                this.loadCategoriesToSelect();
                
                this.categoryToDelete = null;
            }
            
            closeConfirmModal() {
                document.getElementById('confirm-modal').style.display = 'none';
                this.categoryToDelete = null;
            }
            
            filterTransactions() {
                // Implementar filtros avançados
                this.showNotification('Funcionalidade de filtro em desenvolvimento', 'success');
            }
            
            deleteTransaction(id) {
                if (confirm('Tem certeza que deseja excluir esta transação?')) {
                    this.transactions = this.transactions.filter(t => t.id !== id);
                    this.saveTransactions();
                    this.showNotification('Transação excluída com sucesso.', 'success');
                    this.updateDashboard();
                }
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            }
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                const title = document.getElementById('notification-title');
                const messageEl = document.getElementById('notification-message');
                const icon = notification.querySelector('.notification-icon i');
                
                notification.className = `notification ${type}`;
                title.textContent = type === 'success' ? 'Sucesso!' : type === 'error' ? 'Erro!' : 'Atenção!';
                messageEl.textContent = message;
                icon.className = type === 'success' ? 'fas fa-check' : type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-exclamation-triangle';
                
                notification.style.display = 'flex';
                
                // Auto-esconder após 5 segundos
                setTimeout(() => {
                    if (notification.style.display === 'flex') {
                        this.hideNotification();
                    }
                }, 5000);
            }
            
            hideNotification() {
                document.getElementById('notification').style.display = 'none';
            }
            
            saveUsers() {
                localStorage.setItem('finance_users', JSON.stringify(this.users));
            }
            
            saveTransactions() {
                localStorage.setItem('finance_transactions', JSON.stringify(this.transactions));
            }
            
            saveCategories() {
                localStorage.setItem('finance_categories', JSON.stringify(this.categories));
            }
            
            saveBudgets() {
                localStorage.setItem('finance_budgets', JSON.stringify(this.budgets));
            }
        }
        
        // Inicializar aplicação
        const app = new FinanceApp();
    </script>
</body>
</html>